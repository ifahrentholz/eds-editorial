import{_ as w}from"../__chunks__/preload-helper.hlDPvxQM.js";function f(a){return a.toLowerCase().replace(/[^0-9a-z]/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}class L{readBlockConfig(e){const t={};return e.querySelectorAll(":scope > div").forEach(s=>{if(s.children){const o=[...s.children];if(o[1]){const i=o[1],r=f(o[0].textContent??"");let c="";if(i.querySelector("a")){const n=[...i.querySelectorAll("a")];n.length===1?c=n[0].href:c=n.map(h=>h.href)}else if(i.querySelector("img")){const n=[...i.querySelectorAll("img")];n.length===1?c=n[0].src:c=n.map(h=>h.src)}else if(i.querySelector("p")){const n=[...i.querySelectorAll("p")];n.length===1?c=n[0].textContent:c=n.map(h=>h.textContent)}else c=s.children[1].textContent;t[r]=c}}}),t}decorateBlocks(e){e.querySelectorAll("div.section > div > div").forEach(this.decorateBlock)}decorateBlock(e){const t=e.classList[0];if(t){e.classList.add("block"),e.dataset.blockName=t;const s=e.parentElement;s==null||s.classList.add(`${t}-wrapper`);const o=e.closest(".section");o&&o.classList.add(`${t}-container`)}}}function S(a){return f(a).replace(/-([a-z])/g,e=>e[1].toUpperCase())}class P{constructor(e){this.blockService=e}init(e){this.transformSection(e)}transformSection(e){e.querySelectorAll(":scope > div").forEach(t=>{this.adjustMarkup(t),this.processSectionMetaData(t)})}processSectionMetaData(e){const t=e.querySelector("div.section-metadata");if(t){const s=this.blockService.readBlockConfig(t);Object.keys(s).forEach(o=>{o==="style"?s.style.split(",").filter(r=>r).map(r=>f(r.trim())).forEach(r=>e.classList.add(r)):e.dataset[S(o)]=s[o]}),t.parentElement&&t.parentElement.remove()}}adjustMarkup(e){const t=[];let s=!1;[...e.children].forEach(o=>{if(o.tagName==="DIV"||!s){const i=document.createElement("div");t.push(i),s=o.tagName!=="DIV",s&&i.classList.add("default-content-wrapper")}t[t.length-1].append(o)}),t.forEach(o=>e.append(o)),this.decorateImages(),e.classList.add("section"),e.dataset.sectionStatus="initialized",e.style.display="none"}decorateImages(){document.querySelectorAll(".default-content-wrapper picture").forEach(t=>{const s=t.parentElement;s&&s.classList.add("image","main")})}}const p=()=>{const a=document.querySelector("#main");return a?window.location.href==="about:srcdoc"&&a.classList.contains("sidekick-library"):!1},u=(a,e)=>{e.split(",").forEach(t=>{a.classList.add(f(t.trim()))})};function y(a,e=document){const t=a&&a.includes(":")?"property":"name",o=[...e.head.querySelectorAll(`meta[${t}="${a}"]`)].map(i=>i.content).join(", ");return o.length?o:""}const E={mainTsPath:"./src/main.ts",mainScssPath:"./src/styles/sass/main.scss",iconsDirPath:"./public/icons",iconsTypesPath:"./src/icons.types.ts",fontsScssPath:"./src/styles/sass/fonts.scss",lazyStylesScssPath:"./src/styles/sass/lazy-styles.scss",sidekickLibraryStylesScssPath:"./src/styles/sass/sidekick-library-styles.scss"};function b(){return p()?window.parent.location:window.location}const g=a=>{const e=new URL(window.hlx.codeBasePath,window.location.origin);return new URL(a,e)},m=class m{};m.unloaded="unloaded",m.loading="loading",m.loaded="loaded",m.error="error";let d=m;class k{constructor(e,t){this.sectionService=e,this.blockService=t,this.lcpBlocks=["hello-world"],this.init=async()=>{console.log("MainService init"),this.setup(),await this.loadEager(),await this.loadLazy()},this.loadEager=async()=>{document.documentElement.lang="en",this.decorateTemplateAndTheme();const s=document.querySelector("main");if(s){s.setAttribute("id","main"),this.sectionService.init(s),this.blockService.decorateBlocks(s),setTimeout(()=>{document.body.classList.add("show")},100),await this.waitForLCP();try{(window.innerWidth>=900||sessionStorage.getItem("fonts-loaded"))&&await this.loadFonts()}catch{}}},this.loadLazy=async()=>{const{lazyStylesScssPath:s,sidekickLibraryStylesScssPath:o,fontsScssPath:i}=E;try{s&&await this.loadCSS("/dist/lazyStyles/lazyStyles.css"),o&&p()&&await this.loadCSS("/dist/sidekickLibraryStyles/sidekickLibraryStyles.css"),i&&await this.loadFonts(),await this.loadBlocks()}catch(r){console.error("Load lazy error: ",r)}},this.loadBlocks=async()=>{const o=[...document.querySelectorAll(".section")].map(i=>this.loadBlock(i));await Promise.all(o)}}setup(){}decorateTemplateAndTheme(){const e=y("template");e&&u(document.body,e);const t=y("theme");t&&u(document.body,t)}collectBlocks(e){const t=[];return e.querySelectorAll("[data-block-name]").forEach(o=>{t.push({name:o.dataset.blockName,element:o})}),t}async loadBlockModules(e){if((e.element.dataset.blockStatus??d.unloaded)===d.unloaded){e.element.dataset.blockStatus=d.loading;try{const{href:s}=g(`dist/${e.name}/${e.name}.js`),o=await w(()=>import(s),__vite__mapDeps([]));o.default&&await o.default(e.element),e.element.dataset.blockStatus=d.loaded}catch(s){e.element.dataset.blockStatus=d.error,console.error("An error occurred during module import:",s)}}}async loadBlockStyles(e){try{await this.loadCSS(`dist/${e.name}/${e.name}.css`)}catch{console.error(`problem with block '${e.name}' loading styles`)}}showSection(e){e.style.removeProperty("display")}async loadFonts(){await this.loadCSS("dist/fonts/fonts.css");try{b().hostname.includes("localhost")||sessionStorage.setItem("fonts-loaded","true")}catch(e){console.error("Error setting fonts-loaded in session storage",e)}}async loadCSS(e){return new Promise((t,s)=>{const{href:o}=g(e);if(document.querySelector(`head > link[href="${o}"]`))t(!0);else{const i=document.createElement("link");i.rel="stylesheet",i.href=o,i.onload=t,i.onerror=s,document.head.append(i)}})}async waitForLCP(){const e=document.querySelector(".section");if(e){const o=this.collectBlocks(e).map(async i=>{this.lcpBlocks.includes(i.name)&&await Promise.all([this.loadBlockModules(i),this.loadBlockStyles(i)])});await Promise.all(o),this.showSection(e)}document.body.style.display=null;const t=document.querySelector("main img");await new Promise(s=>{t&&!t.complete?(t.setAttribute("loading","eager"),t.setAttribute("fetchpriority","high"),t.addEventListener("load",()=>s()),t.addEventListener("error",()=>s())):s()})}async loadBlock(e){const t=this.collectBlocks(e);if(!t.length){this.showSection(e);return}for(const s of t)Promise.all([this.loadBlockModules(s),this.loadBlockStyles(s)]);this.showSection(e)}}function D(a="dist/main/main.js"){window.hlx=window.hlx||{},window.hlx.RUM_MASK_URL="full",window.hlx.codeBasePath="",window.hlx.lighthouse=new URLSearchParams(window.location.search).get("lighthouse")==="on";const e=document.querySelector(`script[src$="${a}"]`);if(e)try{[window.hlx.codeBasePath]=new URL(e.src).pathname.split(a)}catch(t){console.log("setupHlxObj",t)}}function A(){const a=y("template");a&&u(document.body,a);const e=y("theme");e&&u(document.body,e)}function z(a){return a.trim()===""?void 0:a}function B(){const a=y("language");document.documentElement.lang=z(a)||"en"}class T{constructor(){this.init()}init(){this.beforeLoadEager(),this.loadEager(),this.beforeLoadLazy(),this.loadLazy(),this.beforeLoadDelayed(),this.loadDelayed(),this.initialized()}async beforeLoadEager(){return this.beforeEagerPromise?this.beforeEagerPromise:(console.log(new Date().getTime(),"beforeLoadEager"),this.beforeEagerPromise=new Promise(e=>{setTimeout(()=>{e()},5e3)}),this.beforeEagerPromise)}async loadEager(){return this.eagerPromise?this.eagerPromise:(console.log(new Date().getTime(),"loadEager"),this.eagerPromise=new Promise(e=>{D(),A(),B(),setTimeout(()=>{e()},4500)}),this.eagerPromise)}async beforeLoadLazy(){return this.beforeLazyPromise?this.beforeLazyPromise:(console.log(new Date().getTime(),"beforeLoadLazy"),this.beforeLazyPromise=new Promise(e=>{setTimeout(()=>{e()},4e3)}),this.beforeLazyPromise)}async loadLazy(){return this.lazyPromise?this.lazyPromise:(console.log(new Date().getTime(),"loadLazy"),this.lazyPromise=new Promise(e=>{setTimeout(()=>{e()},3500)}),this.lazyPromise)}async beforeLoadDelayed(){return this.beforeDelayedPromise?this.beforeDelayedPromise:(console.log(new Date().getTime(),"beforeLoadDelayed"),this.beforeDelayedPromise=new Promise(e=>{setTimeout(()=>{e()},3e3)}),this.beforeDelayedPromise)}async loadDelayed(){return this.delayedPromise?this.delayedPromise:(console.log(new Date().getTime(),"loadDelayed"),this.delayedPromise=new Promise(e=>{setTimeout(()=>{e()},2e3)}),this.delayedPromise)}async initialized(){return this.initializedPromise?this.initializedPromise:(console.log(new Date().getTime(),"initialized"),this.initializedPromise=new Promise(e=>{setTimeout(()=>{e()},1e3)}),this.initializedPromise)}}const l=new T;l.initialized().then(()=>{console.log("INITIALIZED")});l.loadDelayed().then(()=>{console.log("LOAD DELAYED 2")});l.loadDelayed().then(()=>{console.log("LOAD DELAYED 3")});l.loadDelayed().then(()=>{console.log("LOAD DELAYED 1")});l.beforeLoadEager().then(()=>{console.log("BEFORE LOAD EAGER")});l.loadEager().then(()=>{console.log("LOAD EAGER")});l.loadLazy().then(()=>{console.log("LOAD LAZY")});l.beforeLoadDelayed().then(()=>{console.log("BEFORE LOAD DELAYED")});l.beforeLoadLazy().then(()=>{console.log("BEFORE LOAD LAZY")});(async function(){try{const a=new L,e=new P(a);await new k(e,a).init()}catch{}})();
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=main.js.map
