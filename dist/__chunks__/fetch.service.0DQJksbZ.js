import{m as C}from"./index.module.oyeuBRIM.js";class f{constructor(){this.runtimeCache=new Map}get(e){return this.runtimeCache.get(e)}set(e,t){this.runtimeCache.set(e,t)}has(e){return this.runtimeCache.has(e)}delete(e){this.runtimeCache.delete(e)}}class l{constructor(){this.requestPipeline=new Map,this.runtimeCache=new f}fetchJson(e,t={}){return this.fetchData(this.getCodeBasePath(e),t,this.getResponseJSON)}async fetchText(e,t={}){return await this.fetchData(this.getCodeBasePath(e),t,this.getResponseText)}async fetchData(e,t,s){const{cacheOptions:n}=t,a=this.getCachedData(e,n);if(a!==null)return a;const i=this.requestPipeline.get(e);if(i!==void 0)return s(await i);const h=fetch(e,t.fetchOptions);this.requestPipeline.set(e,h);const r=await h;this.requestPipeline.delete(e);const o=await s(r);if(this.setCachedData(e,o,n),!r.ok){const c=await r.text();throw C.error(`FetchService: Error fetching data from ${e}: ${c}`),new Error(`Error fetching data from ${e}: ${c}`)}return o}async getResponseJSON(e){return await e.clone().json()}async getResponseText(e){return await e.clone().text()}getCachedData(e,t){return(t==null?void 0:t.cacheType)==="runtime"?this.runtimeCache.get(e)??null:null}setCachedData(e,t,s){(s==null?void 0:s.cacheType)==="runtime"&&this.runtimeCache.set(e,t)}getCodeBasePath(e){const t=e.startsWith("/")?e:`/${e}`;return`${window.hlx.codeBasePath}${t}`}}const m=new l;export{m as F};
//# sourceMappingURL=fetch.service.0DQJksbZ.js.map
