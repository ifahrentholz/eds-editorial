class u{constructor(){this.runtimeCache=new Map}get(e){return this.runtimeCache.get(e)}set(e,t){this.runtimeCache.set(e,t)}has(e){return this.runtimeCache.has(e)}delete(e){this.runtimeCache.delete(e)}}class C{constructor(){this.requestPipeline=new Map,this.runtimeCache=new u}fetchJson(e,t={}){return this.fetchData(this.getCodeBasePath(e),t,this.getResponseJSON)}fetchText(e,t={}){return this.fetchData(this.getCodeBasePath(e),t,this.getResponseText)}async fetchData(e,t,s){const{cacheOptions:n}=t,a=this.getCachedData(e,n);if(a!==null)return a;const r=this.requestPipeline.get(e);if(r!==void 0)return s(await r);const h=fetch(e,t.fetchOptions);this.requestPipeline.set(e,h);const o=await h;this.requestPipeline.delete(e);const i=await s(o);return this.setCachedData(e,i,n),i}async getResponseJSON(e){return await e.clone().json()}async getResponseText(e){return await e.clone().text()}getCachedData(e,t){return(t==null?void 0:t.cacheType)==="runtime"?this.runtimeCache.get(e)??null:null}setCachedData(e,t,s){(s==null?void 0:s.cacheType)==="runtime"&&this.runtimeCache.set(e,t)}getCodeBasePath(e){const t=e.startsWith("/")?e:`/${e}`;return`${window.hlx.codeBasePath}${t}`}}const l=new C;export{l as F};
//# sourceMappingURL=fetch.service.MWvor5vW.js.map
