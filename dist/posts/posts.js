import{j as c,x as i,T as p}from"../__chunks__/lit-element.XkUWx5ik.js";import{P as h,c as y}from"../__chunks__/createOptimizedPicture.uPnuOy_s.js";import{F as m}from"../__chunks__/fetch.service.0DQJksbZ.js";import{o as l}from"../__chunks__/if-defined.JfW-uEqn.js";import{i as w}from"../__chunks__/isSidekickLibraryActive.iN4ARc8o.js";import{m as u}from"../__chunks__/index.module.oyeuBRIM.js";const g=e=>e?i`<h3>${e}</h3>`:p,$=e=>e?e.length>200?i`<p>${e.slice(0,200)}...</p>`:i`<p>${e}</p>`:p,v=e=>{const{postUrl:t,headline:r,text:o,picture:n,buttontext:s}=e;return i`<article><a href="${l(t)}" class="image">${n}</a> ${g(r)} ${$(o)}<ul class="actions"><li><a href="${l(t)}" class="button">${s||"Goto Post"}</a></li></ul></article>`},x=async e=>{if(e.length===0){const t=await h.getPlaceHolder("no posts");return i`<article>${t}</article>`}return e.map(t=>v(t))},T=e=>{var r;return(r=Array.from(e.querySelectorAll("p")).find(o=>o.innerText.trim().length>0))==null?void 0:r.innerText};function H(e){try{return m.fetchText(`${e.path}.plain.html`,{cacheOptions:{cacheType:"runtime"}})}catch(t){u.error(`Post Block: Error while fetching ${e.path}.plain.html`,t);return}}function S(e,t,r){var o,n;return{postUrl:w()?void 0:`${window.hlx.codeBasePath}${e[t].path}`,headline:((o=r.querySelector("h1"))==null?void 0:o.innerText)||((n=r.querySelector("h2"))==null?void 0:n.innerText),text:T(r),buttontext:e[t].buttontext,picture:y({src:e[t].image,alt:e[t].imagealt,width:323,height:199})}}async function j(e){e.innerHTML="";const t=new DOMParser;try{const o=(await m.fetchJson("/query-index.json")).data.filter(a=>a.path.includes("/posts")),f=(await Promise.all(o.map(a=>H(a)))).filter(a=>a!==void 0).map(a=>t.parseFromString(a,"text/html")).map((a,P)=>S(o,P,a));e.style.removeProperty("display");const d=await x(f);c(d,e)}catch(r){u.error("Post Block: Error while fetching posts.",r);const o=await h.getPlaceHolder("error"),n=document.createElement("div"),s=i`<article style="width:100%"><p>${o}</p></article>`;c(s,n),e.innerHTML="",e.appendChild(n)}}export{j as default};
//# sourceMappingURL=posts.js.map
