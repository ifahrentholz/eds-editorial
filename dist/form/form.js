import{j as E,T as f,x as h}from"../__chunks__/lit-element.XkUWx5ik.js";import{a as g}from"../__chunks__/fetch.nZm6Vokn.js";import{t as x}from"../__chunks__/toClassName.qNvfAQ6m.js";const l=[],y=(e,t="")=>{const n=x(`form-${e.name}${t}`);l[n]=l[n]||0;const a=l[n]?`-${l[n]}`:"";return l[n]+=1,`${n}${a}`},p=(e,t)=>{t.id&&(e.id=t.id),t.name&&(e.name=t.name),t.required&&(e.required=t.required),t.placeholder&&(e.placeholder=t.placeholder),t.value&&(e.value=t.value)},c=e=>{const t=document.createElement("div");return e.class&&(t.className=e.class),e.fieldset&&(t.dataset.fieldset=e.fieldset),t},w=e=>{const t=document.createElement("fieldset");if(t.className="row gtr-uniform",p(t,e),e.label){const a=document.createElement("legend");a.textContent=e.label,t.append(a)}const n=c(e);return n.append(t),{fieldElement:t,fieldWrapper:n}},F=e=>{const t=c(e),n=e.class&&e.class.includes("sub-heading")?3:2,a=document.createElement(`h${n}`);return a.textContent=e.value||e.label,a.id=e.id,t.append(a),{fieldElement:a,fieldWrapper:t}},m=e=>{const t=document.createElement("label");return t.id=y(e,"-label"),t.textContent=e.label||e.name,t.setAttribute("for",e.id),t},L=e=>{const t=c(e),n=document.createElement("p");return n.textContent=e.value||e.label,n.id=e.id,t.append(n),{fieldElement:n,fieldWrapper:t}},d=(e,t=!0)=>{const n=document.createElement("input");n.type=e.type,p(n,e);const a=c(e),r=m(e);return n.setAttribute("aria-labelledby",r.id),t?(a.append(r),a.append(n)):(a.append(n),a.append(r)),{fieldElement:n,fieldWrapper:a}},S=e=>{const t=document.createElement("textarea");p(t,e);const n=c(e),a=m(e);return t.setAttribute("aria-labelledby",a.id),n.append(a),n.append(t),{fieldElement:t,fieldWrapper:n}},q=e=>{const{fieldElement:t,fieldWrapper:n}=d(e,!1);return e.value||(t.value="checked"),{fieldElement:t,fieldWrapper:n}},C=e=>{const t=document.createElement("select");p(t,e);const n=({text:r,value:o})=>{const s=document.createElement("option");return s.text=r.trim(),s.value=o.trim(),s.value===t.value&&s.setAttribute("selected",""),t.add(s),s};e.placeholder&&n({text:e.placeholder,value:""}).setAttribute("disabled",""),e.options&&e.options.map(o=>({text:o.trim(),value:o.trim().toLowerCase()})).forEach(o=>n(o));const a=c(e);return a.append(m(e)),a.append(t),{fieldElement:t,fieldWrapper:a}},W=e=>{const{fieldElement:t,fieldWrapper:n}=d(e,!1);return e.value||(t.value=e.label||"on"),{fieldElement:t,fieldWrapper:n}},$=e=>{const{fieldElement:t,fieldWrapper:n}=d(e,!1);t.type="checkbox",e.value||(t.value="on"),t.classList.add("toggle");const a=document.createElement("div");a.classList.add("toggle-switch"),a.append(t),n.append(a);const r=document.createElement("span");return r.classList.add("toggle-slider"),a.append(r),r.addEventListener("click",()=>{t.checked=!t.checked}),{fieldElement:t,fieldWrapper:n}},v=e=>{const t=document.createElement("button");t.textContent=e.label||e.name,t.classList.add(e.class),t.type=e.type;const n=c(e);return n.append(t),{field:t,fieldWrapper:n}},A={headline:F,plaintext:L,text:d,textarea:S,checkbox:q,select:C,radio:W,toggle:$,button:v,fieldset:w,submit:v},k=e=>{e.id=e.id||y(e);const t=e.type.toLowerCase();return(A[t]||d)(e).fieldWrapper},D=e=>({name:e.name,type:e.type,label:e.label||void 0,placeholder:e.placeholder,options:e.options?e.options.split(",").map(t=>t.trim()):void 0,value:e.value||void 0,required:e.required&&(e.required.toLowerCase()==="true"||e.required.toLowerCase()==="x"),id:e.id||void 0,fieldset:e.fieldset||void 0,rows:e.rows||void 0,class:e.class}),T=async e=>(await g(e)).data.map(a=>D(a)),N=e=>e?h`<div style="padding:35px"><form method="post"><div class="row gtr-uniform">${e.map(t=>h`${k(t)}`)}</div></form></div>`:f;function I(e){const t={};return[...e.elements].forEach(n=>{n.name&&n.type!=="submit"&&!n.disabled&&(n.type==="radio"?n.checked&&(t[n.name]=n.value):n.type==="checkbox"?n.checked&&(t[n.name]=t[n.name]?`${t[n.name]},${n.value}`:n.value):t[n.name]=n.value)}),t}function R(e,t){console.error(t),e.querySelector('button[type="submit"]').disabled=!1}async function j(e){if(e.getAttribute("data-submitting")==="true")return;const t=e.querySelector('button[type="submit"]');try{e.setAttribute("data-submitting","true"),t.disabled=!0;const n=I(e),a=await fetch(e.dataset.action,{method:"POST",body:JSON.stringify({data:n}),headers:{"Content-Type":"application/json"}});if(a.ok)console.log(n),e.dataset.confirmation&&(window.location.href=e.dataset.confirmation);else{const r=await a.text();throw new Error(r)}}catch(n){R(e,n)}finally{e.setAttribute("data-submitting","false"),e.reset(),t.disabled=!1}}async function J(e){var o;const t=(o=e.querySelector('a[href$=".json"]'))==null?void 0:o.innerText;if(!t)return;const{pathname:n}=new URL(t),a=await T(n);e.innerHTML="",e.style.removeProperty("display"),E(N(a),e);const r=e.querySelector("form");r&&(r.querySelectorAll("fieldset").forEach(i=>{r.querySelectorAll(`[data-fieldset="${i.name}"`).forEach(b=>{i.append(b)})}),r.dataset.action=n.split(".json")[0],r.addEventListener("submit",i=>{if(i.preventDefault(),r.checkValidity())j(r);else{const u=r.querySelector(":invalid:not(fieldset)");u&&(u.focus(),u.scrollIntoView({behavior:"smooth"}))}}))}export{J as default};
//# sourceMappingURL=form.js.map
