import{x as s,j as d,T as u}from"../__chunks__/lit-element.XkUWx5ik.js";import{a as p}from"../__chunks__/fetch.nZm6Vokn.js";const i=t=>s`<input type="${t.type}" name="${t.name}" id="${t.id}" class="${t.class}" placeholder="${t.placeholder}">`,b=t=>s`<button type="${t.type}" class="${t.class}" id="${t.id}">${t.label}</button>`,m=t=>s`<textarea name="${t.name}" id="${t.id}" class="${t.class}" placeholder="${t.placeholder}" rows="${t.rows||3}"></textarea>`,y=t=>s`<button type="submit" class="${t.class}" id="${t.id}">${t.label?t.label:t.name}</button>`,$=t=>{var a;return s`<select name="${t.name}" id="${t.id}" class="${t.class}">${(a=t.options)==null?void 0:a.map(e=>s`<option>${e}</option>`)}</select>`},h=t=>({text:i,textarea:m,select:$,button:b,submit:y}[t.type]||i).call(void 0,t),v=t=>({name:t.name,type:t.type,placeholder:t.placeholder,label:t.label,id:t.id,class:t.class,rows:t.rows||void 0,options:t.options?t.options.split(",").map(a=>a.trim()):void 0}),w=async t=>(await p(t)).data.map(r=>v(r)),x=t=>t?s`<div style="padding:35px"><h2>Form</h2><form method="post"><div class="row gtr-uniform">${t.map(a=>s`<div class="${a.class}">${h(a)} <label for="${a.id}">${a.label}</label></div>`)}</div></form></div>`:u;function S(t){const a={};return[...t.elements].forEach(e=>{e.name&&e.type!=="submit"&&!e.disabled&&(e.type==="radio"?e.checked&&(a[e.name]=e.value):e.type==="checkbox"?e.checked&&(a[e.name]=a[e.name]?`${a[e.name]},${e.value}`:e.value):a[e.name]=e.value)}),a}function F(t,a){console.error(a),t.querySelector('button[type="submit"]').disabled=!1}async function g(t){if(t.getAttribute("data-submitting")==="true")return;const a=t.querySelector('button[type="submit"]');try{t.setAttribute("data-submitting","true"),a.disabled=!0;const e=S(t),r=await fetch(t.dataset.action,{method:"POST",body:JSON.stringify({data:e}),headers:{"Content-Type":"application/json"}});if(r.ok)console.log(e),t.dataset.confirmation&&(window.location.href=t.dataset.confirmation);else{const n=await r.text();throw new Error(n)}}catch(e){F(t,e)}finally{t.setAttribute("data-submitting","false"),t.reset.click(),a.disabled=!1}}async function E(t){var c;const a=(c=t.querySelector('a[href$=".json"]'))==null?void 0:c.innerText;if(!a)return;const{pathname:e}=new URL(a),r=await w(e);t.innerHTML="",t.style.removeProperty("display"),d(x(r),t);const n=t.querySelector("form");n&&(n.dataset.action=e.split(".json")[0],n.addEventListener("submit",l=>{if(l.preventDefault(),n.checkValidity())g(n);else{const o=n.querySelector(":invalid:not(fieldset)");o&&(o.focus(),o.scrollIntoView({behavior:"smooth"}))}}))}export{E as default};
//# sourceMappingURL=form.js.map
